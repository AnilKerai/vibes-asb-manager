@using Vibes.ASBManager.Web.Models
<MudDialog>
    <TitleContent>@Title</TitleContent>
    <DialogContent>
        <MudForm @ref="_form">
            <MudTextField T="string" Label="Topic Name" @bind-Value="_name" Required="true" tabindex="1" />
            <MudTextField T="string" Label="Default Message TTL (d.hh:mm:ss) - optional" @bind-Value="_ttlText" Placeholder="1.00:00:00" tabindex="2" />
            <MudSwitch T="bool" @bind-Value="_enableBatchedOperations" tabindex="3">Enable Batched Operations</MudSwitch>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="OnCancel" tabindex="98">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="OnSaveAsync" tabindex="99">Create</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance? MudDialog { get; set; }
    [Parameter] public string Title { get; set; } = "Create Topic";

    private MudForm? _form;
    private string _name = string.Empty;
    private string? _ttlText;
    private bool _enableBatchedOperations = true;

    private async Task OnSaveAsync()
    {
        if (_form is not null)
        {
            await _form.Validate();
        }
        if (string.IsNullOrWhiteSpace(_name)) return;
        var req = new CreateTopicRequest
        {
            Name = _name.Trim(),
            TtlText = string.IsNullOrWhiteSpace(_ttlText) ? null : _ttlText,
            EnableBatchedOperations = _enableBatchedOperations
        };
        MudDialog?.Close(DialogResult.Ok(req));
    }

    private void OnCancel() => MudDialog?.Cancel();
}
